<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ğŸ˜ˆ Ultra Degen Farmer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase COMPAT (WAJIB) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>

<body class="bg-slate-950 text-slate-200 p-4">

<h1 class="text-green-400 text-3xl font-bold">ğŸ˜ˆ Ultra Degen Farmer</h1>
<p id="today" class="text-slate-400 mb-4"></p>

<!-- AUTH -->
<div id="authBox" class="bg-slate-900 p-4 rounded-xl mb-4">
  <h3 class="font-bold mb-2">ğŸ” Login / Signup</h3>
  <input id="email" class="w-full p-2 rounded text-black mb-2" placeholder="Email">
  <input id="password" type="password" class="w-full p-2 rounded text-black mb-2" placeholder="Password">
  <button onclick="signup()" class="bg-blue-500 w-full py-2 rounded font-bold mb-2">Signup</button>
  <button onclick="signin()" class="bg-green-500 w-full py-2 rounded font-bold">Signin</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<button onclick="logout()" class="text-red-400 text-sm mb-3">Logout</button>

<div class="bg-slate-900 p-4 rounded-xl mb-4">
  <h3 class="font-bold mb-2">â• Tambah Garapan</h3>
  <input id="taskName" class="w-full p-2 rounded text-black mb-2" placeholder="Nama Airdrop">
  <input id="taskWallet" class="w-full p-2 rounded text-black mb-2" placeholder="Wallet / Label">
  <input id="taskLink" class="w-full p-2 rounded text-black mb-2" placeholder="Link (opsional)">
  <button onclick="addTask()" class="bg-green-500 w-full py-2 rounded font-bold">Tambah</button>
</div>

<div class="bg-slate-900 p-4 rounded-xl mb-4">
  <h3 class="font-bold mb-2">ğŸ“‹ Hari Ini</h3>
  <div id="taskList"></div>
</div>

<div class="bg-slate-900 p-4 rounded-xl mb-4">
  <h3 class="font-bold mb-3">ğŸ“… Heatmap Bulanan</h3>
  <div id="monthHeatmap" class="grid grid-cols-3 gap-3"></div>
</div>

<div class="bg-slate-900 p-4 rounded-xl mb-4">
  <h3 class="font-bold mb-2">ğŸ§  Reminder Farming</h3>
  <input type="time" id="reminderTime" class="w-full p-2 rounded text-black mb-2">
  <button onclick="setReminder()" class="bg-green-500 w-full py-2 rounded font-bold">Set Reminder</button>
</div>

</div>

<script>
/* ========= DATE ========= */
const todayObj = new Date();
const today = todayObj.toISOString().split("T")[0];
const year = todayObj.getFullYear();
document.getElementById("today").innerText = "ğŸ“… " + today;

/* ========= FIREBASE CONFIG ========= */
const firebaseConfig = {
  apiKey: "AIzaSyAMMZ5nXovO8_KnWf3qTHTRsJXoeLsJHHI",
  authDomain: "ultra-degen-farmer.firebaseapp.com",
  databaseURL: "https://ultra-degen-farmer-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "ultra-degen-farmer",
  storageBucket: "ultra-degen-farmer.appspot.com",
  messagingSenderId: "432535783869",
  appId: "1:432535783869:web:9abaf85fb8734b5d7d6ad4"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const dbRoot = firebase.database();

let userRef = null;
let db = { year, tasks: [], history: {}, reminder: null };

/* ========= AUTH ========= */
auth.onAuthStateChanged(user => {
  if (user) {
    authBox.classList.add("hidden");
    app.classList.remove("hidden");

    userRef = dbRoot.ref("ultra_degen/" + user.uid);
    userRef.on("value", snap => {
      if (snap.exists()) db = snap.val();
      else save();
      render();
    });
  } else {
    authBox.classList.remove("hidden");
    app.classList.add("hidden");
  }
});

function signup(){
  auth.createUserWithEmailAndPassword(email.value, password.value)
    .then(()=>alert("Signup berhasil"))
    .catch(e=>alert(e.message));
}
function signin(){
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(e=>alert(e.message));
}
function logout(){ auth.signOut(); }

function save(){ if(userRef) userRef.set(db); }

/* ========= TASK ========= */
function addTask(){
  if(!taskName.value || !taskWallet.value) return alert("Lengkapi data");
  db.tasks.push({id:crypto.randomUUID(),name:taskName.value,wallet:taskWallet.value,link:taskLink.value});
  taskName.value=taskWallet.value=taskLink.value="";
  save();
}
function toggleTask(id){
  if(!db.history[today]) db.history[today]={};
  db.history[today][id]=!db.history[today][id];
  save();
}
function render(){
  taskList.innerHTML="";
  db.tasks.forEach(t=>{
    const done=db.history[today]?.[t.id];
    taskList.innerHTML+=`
    <div class="flex justify-between py-2 border-b border-slate-700">
      <div class="${done?'line-through text-green-400':''}">${t.name} (${t.wallet})</div>
      <input type="checkbox" ${done?'checked':''} onchange="toggleTask('${t.id}')">
    </div>`;
  });
  drawHeatmap();
}

/* ========= HEATMAP ========= */
function drawHeatmap(){
  monthHeatmap.innerHTML="";
  const m=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
  m.forEach((x,i)=>{
    let c=0;
    Object.keys(db.history).forEach(d=>{
      const dt=new Date(d);
      if(dt.getFullYear()===year && dt.getMonth()===i)
        c+=Object.values(db.history[d]).filter(v=>v).length;
    });
    monthHeatmap.innerHTML+=`
    <div class="rounded-xl p-4 text-center ${c?'bg-green-700':'bg-slate-700'}">
      <b>${x}</b><div class="text-xs">${c} done</div>
    </div>`;
  });
}

/* ========= REMINDER ========= */
function setReminder(){
  db.reminder=reminderTime.value;
  save();
  Notification.requestPermission();
}
setInterval(()=>{
  if(db.reminder===new Date().toTimeString().slice(0,5))
    new Notification("â° Waktunya Farming!");
},60000);
</script>

</body>
</html>
